{% extends 'base.html' %}
{% load static %}

{% block content %}

    <main class="container-fluid no-gutters mx-auto px-2">

        <div class="row no-gutters">

            <div class="col-12">
                <h2 class="text-center">Shop Our Products</h2>
            </div>

        </div>

        <div class="row no-gutters">
            
            <div class="col-12 col-md-6 my-auto order-md-last d-flex justify-content-center justify-content-md-end">
                {% include "./includes/components/odering-selector-menu.html" %}
            </div>
            
            <div class="col-12 col-md-6 order-md-first">
                
                <p class="text-muted mt-3 text-center text-md-left">
                    
                    {% if search_query or current_categories or current_ordering or current_subcategories == 'None_None' %}
                        <span class="small"><a href="{% url 'products' %}">Back to All Products</a> | </span>
                    {% endif %}
                    
                    Showing {{ products|length }} Product{%if products|length > 1 %}s{%endif%}{% if search_query %} related to <strong>"{{ search_query }}"</strong>{% else %} of {{ product_count }}{% endif %}
                
                </p>
            </div>

        </div>

        <div class="row w-100 my-3 no-gutters">
            <div class="col-sm-1"></div>
            <div class="col-sm-10">
                <div class="row w-100 card-deck m-0 no-gutters">
                {% for product in products %}
                    {% if forloop.counter|divisibleby:5 %}
                    <div class="col-sm-1"></div>
                        <div class="row w-100 card-deck m-0 no-gutters">
                            <div class="col-sm-1"></div>
                    {% endif %}

                    <div class="col-sm-6 col-lg-4 col-xl-3 mt-1 ">
                        
                        {% include "./includes/components/product-card.html" %} 
                        
                    </div>
                    {% if forloop.counter|divisibleby:4 %}
                </div>   
            </div>
                {% endif %}

            {% endfor %}
            <div class="col-sm-1"></div>      
            </div>
            
        </div>
        {% include "./includes/components/pagination.html" %}    
    </main>
    
{% endblock %}

{% block postloadjs %}
    {{ block.super }}
    <script type="text/javascript">
        // get the selector element from the dom

        $('#sorting-menu').change(function() {
            // get the selected menu option value
            const menuChoiceValue = $(this).val();

            // Get the current URL
            const pageUrl = new URL(window.location);
            
            if(menuChoiceValue != 'default') {
                                
                // set the ordering parameters in the URL
                pageUrl.searchParams.set('ordering', menuChoiceValue);

                // redirect to the new URL which includes the above parameter
                window.location.replace(pageUrl);

            } else {

                // remove the orderingquery parameters from the URL
                pageUrl.searchParams.delete('ordering');

                window.location.replace(pageUrl);
            }

        })
    </script>
    {% include 'products/includes/scripts/qty-selector-btn-scripts.html' %}
{% endblock %}
